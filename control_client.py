import socket, json, time

def send(req):
    s = socket.create_connection(('127.0.0.1', 53421), timeout=2)
    s.sendall((json.dumps(req) + '\n').encode('utf-8'))
    resp = s.recv(8192).decode('utf-8')
    s.close()
    print(resp)
    return resp

# list devices (copy ids)
send({"cmd":"list_devices"})

# open both input & output so loopback works (use your device ids)
send({"cmd":"open","input":7,"output":4,"sr":48000})

# send an MFSK frame
send({
 "cmd":"send_frame",
 "mode":"mfsk",
 "mfsk_m":256,
 "mfsk_center":1500.0,
 "mfsk_spacing":10.0,
 "symbol_len_ms":40,
 "preamble_repeats":4,
 "payload_bits":"010101000100010101010011010101000100100101001110010001110010000001010100010001010101001101010100010010010100111001000111001000000100100001010101010100110100100000100000010100000101001001001111010101000100111101000011010011110100110000100000010010110100001100110001010101110101101001010001010101000100010101010011010101000100100101001110010001110010000001010100010001010101001101010100010010010100111001000111001000000100100001010101010100110100100000100000010100000101001001001111010101000100111101000011010011110100110000100000010010110100001100110001010101110101101001010001"
})


# Optionally start tone fallback
send({"cmd":"start_tx","tone_freq":700})
time.sleep(1)
send({"cmd":"stop_tx"})
send({"cmd":"close"})
